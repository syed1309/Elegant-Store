{% extends "base.html" %}
{% block title %}{{ item.title }} - Abaya Store{% endblock %}
{% block head %}
<link href="{{ url_for('static', filename='css/product.css') }}" rel="stylesheet" />
<style>
    .wishlist-btn.active {
        background: #e74c3c !important;
        color: white !important;
    }
    
    .wishlist-btn.active:hover {
        background: #c0392b !important;
    }

    /* Out of stock styles */
    .out-of-stock-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.5rem;
        font-weight: bold;
        border-radius: 15px;
        z-index: 2;
    }

    .out-of-stock-btn {
        background: #95a5a6 !important;
        cursor: not-allowed !important;
    }

    .out-of-stock-btn:hover {
        background: #95a5a6 !important;
        transform: none !important;
    }
</style>
{% endblock %}

{% block content %}
<!-- Product Detail Section -->
<section class="product-detail">
    <div class="container">
        <div class="product-grid">
            <!-- Product Images -->
            <div class="product-images">
                <div class="main-image" style="position: relative;">
                    <img src="{{ url_for('static', filename=item.image) }}" alt="{{ item.title }}" id="mainImage">
                    <!-- Out of Stock Overlay -->
                    {% if not item.in_stock %}
                    <div class="out-of-stock-overlay">
                        Out of Stock
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Product Info -->
            <div class="product-info">
                <div class="product-content">
                    <div class="scrollable-content">
                        <nav class="breadcrumb">
                            <a href="{{ url_for('home') }}">Home</a>
                            <span>/</span>
                            <a href="{{ url_for('collection') }}">{{ item.section }}</a>
                            <span>/</span>
                            <span class="current">{{ item.title }}</span>
                        </nav>

                        <h1 class="product-title">{{ item.title }}</h1>
                        <div class="product-price">{{ item.price }}</div>
                        
                        <div class="product-rating">
                            <div class="stars">
                                ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
                                <span class="rating-text">4.8 (128 Reviews)</span>
                            </div>
                        </div>

                        <div class="product-description">
                            <p>{{ item.description }}</p>
                        </div>

                        <div class="product-features">
                            <div class="feature">
                                <span class="feature-icon">üöö</span>
                                <span>Free Shipping</span>
                            </div>
                            <div class="feature">
                                <span class="feature-icon">‚Ü©Ô∏è</span>
                                <span>30-Day Returns</span>
                            </div>
                            <div class="feature">
                                <span class="feature-icon">üîí</span>
                                <span>Secure Payment</span>
                            </div>
                        </div>

                        <!-- Product Meta -->
                        <div class="product-meta">
                            <div class="meta-item">
                                <strong>Category:</strong>
                                <span>{{ item.section }}</span>
                            </div>
                            <div class="meta-item">
                                <strong>SKU:</strong>
                                <span>AB{{ "%04d"|format(item.id) }}</span>
                            </div>
                            <div class="meta-item">
                                <strong>Availability:</strong>
                                <span class="in-stock">In Stock</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="product-actions">
                    <div class="quantity-selector">
                        <label for="quantity">Quantity:</label>
                        <div class="quantity-controls">
                            <button type="button" class="quantity-btn" id="decrease">-</button>
                            <input type="number" id="quantity" value="1" min="1" max="10">
                            <button type="button" class="quantity-btn" id="increase">+</button>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="add-to-cart-btn" onclick="addToCart('{{ item.id }}')">
                            <span class="btn-icon">üõí</span>
                            Add to Cart
                        </button>
                        <button class="wishlist-btn {{ 'active' if in_wishlist }}" onclick="addToWishlist('{{item.id }}')" id="wishlistBtn">
                            <span class="btn-icon">‚ù§Ô∏è</span>
                            {{ 'In Wishlist' if in_wishlist else 'Wishlist' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Product Details Tabs -->
<section class="product-tabs">
    <div class="container">
        <div class="tabs-container">
            <div class="tabs-header">
                <button type="button" class="tab-btn active" data-tab="description">Description</button>
                <button type="button" class="tab-btn" data-tab="details">Product Details</button>
                <button type="button" class="tab-btn" data-tab="reviews">Reviews</button>
                <button type="button" class="tab-btn" data-tab="shipping">Shipping</button>
            </div>

            <div class="tabs-content">
                <!-- Description Tab -->
                <div class="tab-pane active" id="description">
                    <h3>Product Description</h3>
                    <p>{{ item.description }}</p>
                    <p>This elegant abaya is crafted with premium materials to ensure both comfort and style. Perfect for various occasions, from casual outings to formal events.</p>
                    
                    <div class="features-list">
                        <h4>Key Features:</h4>
                        <ul>
                            <li>Premium quality fabric with excellent durability</li>
                            <li>Comfortable and breathable for all-day wear</li>
                            <li>Elegant design with modern contemporary touches</li>
                            <li>Perfect fit for all body types with adjustable features</li>
                            <li>Easy to maintain and care for with simple washing instructions</li>
                            <li>Handcrafted with attention to detail and precision</li>
                        </ul>
                    </div>

                    <div class="material-info">
                        <h4>Material & Craftsmanship:</h4>
                        <p>Our abayas are made from premium cotton blend fabric that offers both comfort and durability. Each piece is carefully crafted by skilled artisans who pay attention to every detail, ensuring you receive a product of the highest quality.</p>
                    </div>
                </div>

                <!-- Details Tab -->
                <div class="tab-pane" id="details">
                    <h3>Product Details & Specifications</h3>
                    <div class="details-grid">
                        <div class="detail-item">
                            <strong>Material:</strong>
                            <span>Premium Cotton Blend</span>
                        </div>
                        <div class="detail-item">
                            <strong>Color:</strong>
                            <span>As shown in image</span>
                        </div>
                        <div class="detail-item">
                            <strong>Size:</strong>
                            <span>One Size Fits Most (Adjustable)</span>
                        </div>
                        <div class="detail-item">
                            <strong>Length:</strong>
                            <span>Standard Abaya Length (55-60 inches)</span>
                        </div>
                        <div class="detail-item">
                            <strong>Care Instructions:</strong>
                            <span>Machine wash cold, gentle cycle, tumble dry low</span>
                        </div>
                        <div class="detail-item">
                            <strong>Fabric Care:</strong>
                            <span>Do not bleach, iron on low heat</span>
                        </div>
                        <div class="detail-item">
                            <strong>Origin:</strong>
                            <span>Handcrafted with care</span>
                        </div>
                        <div class="detail-item">
                            <strong>Package Includes:</strong>
                            <span>1 Abaya, Care Instructions</span>
                        </div>
                    </div>

                    <div class="sizing-guide">
                        <h4>Size Guide:</h4>
                        <p>This abaya is designed to fit most body types comfortably. The adjustable features ensure a perfect fit for various sizes.</p>
                    </div>
                </div>

                <!-- Reviews Tab -->
                <div class="tab-pane" id="reviews">
                    <h3>Customer Reviews & Ratings</h3>
                    <div class="reviews-summary">
                        <div class="overall-rating">
                            <div class="rating-score">4.8</div>
                            <div class="rating-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                            <div class="rating-count">Based on 128 reviews</div>
                        </div>
                        <div class="rating-breakdown">
                            <div class="rating-bar">
                                <span>5 Stars</span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 85%;"></div>
                                </div>
                                <span>85%</span>
                            </div>
                            <div class="rating-bar">
                                <span>4 Stars</span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 12%;"></div>
                                </div>
                                <span>12%</span>
                            </div>
                            <div class="rating-bar">
                                <span>3 Stars</span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 2%;"></div>
                                </div>
                                <span>2%</span>
                            </div>
                            <div class="rating-bar">
                                <span>2 Stars</span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 1%;"></div>
                                </div>
                                <span>1%</span>
                            </div>
                            <div class="rating-bar">
                                <span>1 Star</span>
                                <div class="bar-container">
                                    <div class="bar-fill" style="width: 0%;"></div>
                                </div>
                                <span>0%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="review-item">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer">Sarah M.</div>
                                <div class="review-date">January 15, 2024</div>
                            </div>
                            <div class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        </div>
                        <p>"Absolutely love this abaya! The quality is exceptional and it's so comfortable to wear. The fabric feels premium and the stitching is perfect. Will definitely purchase more colors!"</p>
                    </div>
                    
                    <div class="review-item">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer">Aisha K.</div>
                                <div class="review-date">January 10, 2024</div>
                            </div>
                            <div class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        </div>
                        <p>"Beautiful design and perfect fit. The attention to detail is remarkable. I've received so many compliments whenever I wear it. The delivery was fast and packaging was excellent."</p>
                    </div>

                    <div class="review-item">
                        <div class="review-header">
                            <div class="reviewer-info">
                                <div class="reviewer">Fatima A.</div>
                                <div class="review-date">December 28, 2023</div>
                            </div>
                            <div class="review-stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</div>
                        </div>
                        <p>"Very satisfied with my purchase. The abaya is comfortable and well-made. The only reason I'm giving 4 stars is because I wish there were more color options available."</p>
                    </div>

                    <div class="write-review">
                        <h4>Write a Review</h4>
                        <p>Share your experience with this product</p>
                        <button class="review-btn">Write Review</button>
                    </div>
                </div>

                <!-- Shipping Tab -->
                <div class="tab-pane" id="shipping">
                    <h3>Shipping & Delivery Information</h3>
                    <div class="shipping-info">
                        <div class="shipping-item">
                            <strong>Free Shipping:</strong>
                            <span>On all orders over ‚Çπ2000</span>
                        </div>
                        <div class="shipping-item">
                            <strong>Standard Shipping:</strong>
                            <span>‚Çπ99 for orders below ‚Çπ2000</span>
                        </div>
                        <div class="shipping-item">
                            <strong>Delivery Time:</strong>
                            <span>3-5 business days within India</span>
                        </div>
                        <div class="shipping-item">
                            <strong>Express Shipping:</strong>
                            <span>Available at additional charges (1-2 days)</span>
                        </div>
                        <div class="shipping-item">
                            <strong>Returns:</strong>
                            <span>30-day easy returns with full refund</span>
                        </div>
                        <div class="shipping-item">
                            <strong>Exchange:</strong>
                            <span>Free exchange within 15 days</span>
                        </div>
                        <div class="shipping-item">
                            <strong>International Shipping:</strong>
                            <span>Available with additional charges (7-14 days)</span>
                        </div>
                        <div class="shipping-item">
                            <strong>Order Tracking:</strong>
                            <span>Real-time tracking provided for all orders</span>
                        </div>
                    </div>

                    <div class="shipping-policy">
                        <h4>Shipping Policy:</h4>
                        <p>We process all orders within 24 hours of placement. Once shipped, you will receive a tracking number via email and SMS. For any shipping-related queries, please contact our customer support team.</p>
                    </div>

                    <div class="return-policy">
                        <h4>Return Policy:</h4>
                        <p>We offer a 30-day return policy from the date of delivery. Items must be in original condition with tags attached. Return shipping is free for defective or wrong items.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Similar Products -->
<section class="similar-products">
    <div class="container">
        <h2 class="section-title">You May Also Like</h2>
        <div class="products-grid">
            {% for similar_item in similar_items %}
            <div class="product-card">
                <div class="product-image">
                    <img src="{{ url_for('static', filename=similar_item.image) }}" alt="{{ similar_item.title }}">
                </div>
                <div class="product-info">
                    <h3 class="product-title">{{ similar_item.title }}</h3>
                    <p class="product-category">{{ similar_item.section }}</p>
                    <p class="product-price">{{ similar_item.price }}</p>
                    <a href="{{ url_for('product', title=similar_item.title) }}" class="view-btn">View Details</a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
function addToCart(itemId) {
    const quantity = document.getElementById('quantity').value;
    
    fetch(`/cart/add/${itemId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification(data.message, 'success');
                updateCartCount();
            } else {
                showNotification(data.message, 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error adding to cart', 'error');
        });
}

function addToWishlist(itemId) {
    fetch(`/wishlist/add/${itemId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification(data.message, 'success');
                // Update button state
                const wishlistBtn = document.getElementById('wishlistBtn');
                wishlistBtn.classList.add('active');
                wishlistBtn.innerHTML = '<span class="btn-icon">‚ù§Ô∏è</span> In Wishlist';
            } else {
                showNotification(data.message, 'info');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Error adding to wishlist', 'error');
        });
}

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: ${type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#f39c12'};
        color: white;
        padding: 15px 20px;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        z-index: 10000;
        animation: slideIn 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
            if (notification.parentNode) {
                document.body.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

function updateCartCount() {
    setTimeout(() => {
        window.location.reload();
    }, 1000);
}

// Quantity controls
document.addEventListener('DOMContentLoaded', function() {
    const quantityInput = document.getElementById('quantity');
    const decreaseBtn = document.getElementById('decrease');
    const increaseBtn = document.getElementById('increase');
    
    if (decreaseBtn && increaseBtn && quantityInput) {
        decreaseBtn.addEventListener('click', () => {
            if (quantityInput.value > 1) {
                quantityInput.value = parseInt(quantityInput.value) - 1;
            }
        });
        
        increaseBtn.addEventListener('click', () => {
            if (quantityInput.value < 10) {
                quantityInput.value = parseInt(quantityInput.value) + 1;
            }
        });
    }

    // Tab functionality
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabPanes = document.querySelectorAll('.tab-pane');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            // Remove active class from all buttons and panes
            tabBtns.forEach(b => b.classList.remove('active'));
            tabPanes.forEach(p => p.classList.remove('active'));
            
            // Add active class to clicked button and corresponding pane
            btn.classList.add('active');
            const tabId = btn.getAttribute('data-tab');
            document.getElementById(tabId).classList.add('active');
        });
    });
});

// Add CSS for notifications
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}